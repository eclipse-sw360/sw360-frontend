// Copyright (C) TOSHIBA CORPORATION, 2023. Part of the SW360 Frontend Project.
// Copyright (C) Toshiba Software Development (Vietnam) Co., Ltd., 2023. Part of the SW360 Frontend Project.

// This program and the accompanying materials are made
// available under the terms of the Eclipse Public License 2.0
// which is available at https://www.eclipse.org/legal/epl-2.0/

// SPDX-License-Identifier: EPL-2.0
// License-Filename: LICENSE

import { useTranslations } from 'next-intl'

import { LinkedVulnerability } from '@/object-types'
import { CommonUtils } from '@/utils'

interface Props {
    vulnerData: Array<LinkedVulnerability>
}

const VulnerabilitiesMatchingStatistics = ({ vulnerData }: Props) : JSX.Element => {
    const t = useTranslations('default')

    const matchedByHistogram = vulnerData.reduce((accumulator: { [key: string]: number }, value: LinkedVulnerability) => {
        const matchedBy = CommonUtils.isNullOrUndefined(value.releaseVulnerabilityRelation.matchedBy)
            ? 'UNKNOWN'
            : value.releaseVulnerabilityRelation.matchedBy
        accumulator[matchedBy] = ++accumulator[matchedBy] || 1
        return accumulator
    }, {})

    return (
        <>
            <h5
                style={{
                    color: '#5D8EA9',
                    borderBottom: '1px solid #5D8EA9',
                    fontSize: '1rem',
                    fontWeight: 'bold',
                    textTransform: 'uppercase',
                }}
            >
                {t('Vulnerability matching statistics')}
            </h5>
            <ul>
                {Object.entries(matchedByHistogram).map(([matchedBy, count]) => {
                    return (
                        <li key={matchedBy}>
                            {t.rich('number of the vulnerabilities were matched by', {
                                count: count,
                                matchedBy: matchedBy,
                                strong: (chunks) => <b>{chunks}</b>,
                            })}
                        </li>
                    )
                })}
            </ul>
        </>
    )
}

export default VulnerabilitiesMatchingStatistics
